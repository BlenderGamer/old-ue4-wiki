<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <link href="https://www.epicgames.com/tos"/>
  <title>
   C++ Camera Controlled Turrets - Old UE4 Wiki
  </title>
  <link href="../styles.css" rel="stylesheet"/>
 </head>
 <body>
  <nav id="top-nav">
   <a href="../index.html" title="Home">
    Home
   </a>
  </nav>
  <div class="mw-body" id="content" role="main">
   <a id="top">
   </a>
   <div class="mw-indicators mw-body-content">
   </div>
   <h1 class="firstHeading" id="firstHeading" lang="en">
    C++ Camera Controlled Turrets
   </h1>
   <div class="mw-body-content" id="bodyContent">
    <div class="noprint" id="siteSub">
     From Epic Wiki
    </div>
    <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
     <div class="mw-parser-output">
      <p>
      </p>
      <div class="toc" id="toc">
       <div class="toctitle">
        <h2>
         Contents
        </h2>
       </div>
       <ul>
        <li class="toclevel-1 tocsection-1">
         <a href="#Overview">
          <span class="tocnumber">
           1
          </span>
          <span class="toctext">
           Overview
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-2">
         <a href="#Requirements">
          <span class="tocnumber">
           2
          </span>
          <span class="toctext">
           Requirements
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-3">
         <a href="#Our_Goals">
          <span class="tocnumber">
           3
          </span>
          <span class="toctext">
           Our Goals
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-4">
         <a href="#Getting_Started">
          <span class="tocnumber">
           4
          </span>
          <span class="toctext">
           Getting Started
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-5">
           <a href="#Set_up_the_Ship_Mesh">
            <span class="tocnumber">
             4.1
            </span>
            <span class="toctext">
             Set up the Ship Mesh
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-6">
           <a href="#Set_up_the_Turret_Barrel_Mesh">
            <span class="tocnumber">
             4.2
            </span>
            <span class="toctext">
             Set up the Turret Barrel Mesh
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-7">
           <a href="#Creating_The_Base_Classes">
            <span class="tocnumber">
             4.3
            </span>
            <span class="toctext">
             Creating The Base Classes
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-8">
         <a href="#Initializing_the_Ship_and_Turret_Classes">
          <span class="tocnumber">
           5
          </span>
          <span class="toctext">
           Initializing the Ship and Turret Classes
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-9">
           <a href="#ShipBase_Class">
            <span class="tocnumber">
             5.1
            </span>
            <span class="toctext">
             ShipBase Class
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-10">
           <a href="#TurretBase_Class">
            <span class="tocnumber">
             5.2
            </span>
            <span class="toctext">
             TurretBase Class
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-11">
         <a href="#Extending_The_Base_Classes">
          <span class="tocnumber">
           6
          </span>
          <span class="toctext">
           Extending The Base Classes
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-12">
         <a href="#Adding_Turret_Functionality">
          <span class="tocnumber">
           7
          </span>
          <span class="toctext">
           Adding Turret Functionality
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-13">
           <a href="#Turret_Spawn_Logic">
            <span class="tocnumber">
             7.1
            </span>
            <span class="toctext">
             Turret Spawn Logic
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-14">
           <a href="#Turret_Control">
            <span class="tocnumber">
             7.2
            </span>
            <span class="toctext">
             Turret Control
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-15">
           <a href="#Turret_Firing">
            <span class="tocnumber">
             7.3
            </span>
            <span class="toctext">
             Turret Firing
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-16">
         <a href="#Conclusion">
          <span class="tocnumber">
           8
          </span>
          <span class="toctext">
           Conclusion
          </span>
         </a>
        </li>
       </ul>
      </div>
      <h2>
       <span class="mw-headline" id="Overview">
        Overview
       </span>
      </h2>
      <p>
       This tutorial is aimed at people who want to do a little more C++ programming. Having some prior knowledge of C++ is not needed to follow this tutorial. It will take you from the beginning to end. The end result is having a player controlled ship which it's turrets will follow the direction of the camera.
      </p>
      <p>
       So I've decided that since I've finally figured out how to make turrets work on battleships/spaceships that I should share my discovery and help anyone else who is having difficulties figuring it out with C++! I'm going to take you through the entire process from start to finish, including the set up needed to get everything working just right. So this tutorial may be a little bit long, but I promise you it's worth it!
      </p>
      <h2>
       <span class="mw-headline" id="Requirements">
        Requirements
       </span>
      </h2>
      <p>
       Before you start this tutorial, you should have a few things prepared and ready.
      </p>
      <ol>
       <li>
        C++ empty project.
       </li>
       <li>
        Ship mesh
       </li>
       <li>
        Turret Chassis mesh
       </li>
       <li>
        Turret Barrel mesh
       </li>
      </ol>
      <p>
       For a little clarification on the Turret meshes, you want two separate meshes to bring into the engine, the body of the turret (which we will refer to as the Chassis) and the barrels of the turret (which we will refer to as the Barrels).
      </p>
      <p>
       Go on ahead and get all those three meshes imported into the project!
      </p>
      <h2>
       <span class="mw-headline" id="Our_Goals">
        Our Goals
       </span>
      </h2>
      <p>
       So we are setting out with a few goals to accomplish in this tutorial.
      </p>
      <ol>
       <li>
        We want to set up the Ship and Turret base classes
       </li>
       <li>
        Extend the Ship and Turret base classes into blueprints
       </li>
       <li>
        Get the turrets to spawn on the Ship
       </li>
       <li>
        Make the turrets rotate and pitch properly
       </li>
       <li>
        Bonus: Get the turrets to fire!
       </li>
      </ol>
      <h2>
       <span class="mw-headline" id="Getting_Started">
        Getting Started
       </span>
      </h2>
      <h3>
       <span class="mw-headline" id="Set_up_the_Ship_Mesh">
        Set up the Ship Mesh
       </span>
      </h3>
      <p>
       Before we go to much further, we want to make sure that your ship mesh is set up correctly! What we want to do is add some sockets to the ship so our code can spawn the turrets in correctly and at the right locations. So go to where your ship mesh is and double click it. This should bring up the mesh editor in the engine.
      </p>
      <p>
       Now make sure that the Sockets button is highlighted in the top navbar, and then go to Window -&gt; Socket Manager.
      </p>
      <p>
       This will make a little window appear off to the right, with a green button named Create Socket.
      </p>
      <p>
       Go ahead and create some sockets and place them where ever on the mesh you wish! Mine are set up as below.
      </p>
      <p>
      </p>
      <p>
       <img alt="ShipSockets.png" class="" height="1013" src="../assets/c-camera-controlled-turrets/0.png" width="1918"/>
      </p>
      <h3>
       <span class="mw-headline" id="Set_up_the_Turret_Barrel_Mesh">
        Set up the Turret Barrel Mesh
       </span>
      </h3>
      <p>
       Just like the Ship Mesh and placing it's sockets, we want to do the same thing for the barrel mesh, but this time where putting the sockets at the end of the barrels. This is going to be used to help give an origin point of where we are going to spawn our projectiles.
      </p>
      <p>
      </p>
      <p>
       <img alt="TurretSockets.png" class="" height="561" src="../assets/c-camera-controlled-turrets/1.png" width="1530"/>
      </p>
      <h3>
       <span class="mw-headline" id="Creating_The_Base_Classes">
        Creating The Base Classes
       </span>
      </h3>
      <p>
       So let's get those base classes created! We will begin with the Ship Base Class.
      </p>
      <p>
       So once your project is open in the editor, go to File -&gt; New C++ Class.
      </p>
      <p>
       You will be prompted with a screen of what to inherit. We want our parent class to be the Pawn.
      </p>
      <p>
       <img alt="ParentClass.png" class="" height="608" src="../assets/c-camera-controlled-turrets/2.png" width="960"/>
      </p>
      <p>
       Then we want to give the class a name, ShipBase is what I used. You can name it anything.
      </p>
      <p>
       <img alt="NameClass.png" class="" height="608" src="../assets/c-camera-controlled-turrets/3.png" width="960"/>
      </p>
      <p>
       It will only take a moment for the engine to add the code file and structure to your project, so sit tight!
      </p>
      <p>
       Once that is done, go ahead and repeat this section for the Turret. I named the class TurretBase.
      </p>
      <p>
       So now you should have two classes created and the files should be open in your IDE.
      </p>
      <h2>
       <span class="mw-headline" id="Initializing_the_Ship_and_Turret_Classes">
        Initializing the Ship and Turret Classes
       </span>
      </h2>
      <p>
       Our two classes should look the same and have a few things in the code already like below.
      </p>
      <p>
       ShipBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cp">#include</span> <span class="cpf">"TurretTutorial.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"ShipBase.h"</span><span class="cp"></span>


<span class="c1">// Sets default values</span>
<span class="n">AShipBase</span><span class="o">::</span><span class="n">AShipBase</span><span class="p">()</span>
<span class="p">{</span>
 	<span class="c1">// Set this pawn to call Tick() every frame.  You can turn this off to improve performance if you don't need it.</span>
	<span class="n">PrimaryActorTick</span><span class="p">.</span><span class="n">bCanEverTick</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="p">}</span>

<span class="c1">// Called when the game starts or when spawned</span>
<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span>
	
<span class="p">}</span>

<span class="c1">// Called every frame</span>
<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span> <span class="kt">float</span> <span class="n">DeltaTime</span> <span class="p">)</span>
<span class="p">{</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span> <span class="n">DeltaTime</span> <span class="p">);</span>

<span class="p">}</span>

<span class="c1">// Called to bind functionality to input</span>
<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="k">class</span> <span class="nc">UInputComponent</span><span class="o">*</span> <span class="n">InputComponent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="n">InputComponent</span><span class="p">);</span>

<span class="p">}</span>
</pre>
      </div>
      <p>
       ShipBase.h
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="c1">// Fill out your copyright notice in the Description page of Project Settings.</span>

<span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">"GameFramework/Pawn.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"ShipBase.generated.h"</span><span class="cp"></span>

<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">TURRETTUTORIAL_API</span> <span class="nl">AShipBase</span> <span class="p">:</span> <span class="k">public</span> <span class="n">APawn</span>
<span class="p">{</span>
	<span class="n">GENERATED_BODY</span><span class="p">()</span>

<span class="k">public</span><span class="o">:</span>
	<span class="c1">// Sets default values for this pawn's properties</span>
	<span class="n">AShipBase</span><span class="p">();</span>

	<span class="c1">// Called when the game starts or when spawned</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">BeginPlay</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
	
	<span class="c1">// Called every frame</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Tick</span><span class="p">(</span> <span class="kt">float</span> <span class="n">DeltaSeconds</span> <span class="p">)</span> <span class="k">override</span><span class="p">;</span>

	<span class="c1">// Called to bind functionality to input</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">SetupPlayerInputComponent</span><span class="p">(</span><span class="k">class</span> <span class="nc">UInputComponent</span><span class="o">*</span> <span class="n">InputComponent</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

	
	
<span class="p">};</span>
</pre>
      </div>
      <p>
       So the next step is to get our ShipBase and TurretBase classes to actually work so we can extend these base classes out into Blueprints and do some fun stuff with them! The main reason why we are creating a base class for the ship and turret and then extending it out into Blueprints is observing a thing called Object Oriented Programming. I wont go into the semantics of it, but the idea is that we have a common parent class of a Ship and a Turret. We then can create as many variations of these base classes in either Blueprints or Code. This creates flexibility and eliminates having a ton of duplicate code!
      </p>
      <p>
       In short the ShipBase and TurretBase classes will have all the common properties shared among any ships and any turrets.
      </p>
      <h3>
       <span class="mw-headline" id="ShipBase_Class">
        ShipBase Class
       </span>
      </h3>
      <p>
       So let us get our ShipBase.h filled out! First we want to include our newly created TurretBase class.
      </p>
      <p>
       ShipBase.h
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="c1">// TurretBase Include</span>
<span class="cp">#include</span> <span class="cpf">"../Turrets/TurretBase.h"</span><span class="cp"></span>
</pre>
      </div>
      <p>
       Now we want to get everything else set up, including our Mesh of our ship, then build up the camera and get a few more things sorted. Take a look at the rest of the code below.
      </p>
      <p>
       ShipBase.h
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">TURRETTUTORIAL_API</span> <span class="nl">AShipBase</span> <span class="p">:</span> <span class="k">public</span> <span class="n">APawn</span>
<span class="p">{</span>
	<span class="n">GENERATED_BODY</span><span class="p">()</span>

<span class="k">public</span><span class="o">:</span>

	<span class="cm">/** StaticMesh component that will be the visuals for our flying ship */</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">VisibleDefaultsOnly</span><span class="p">,</span> <span class="n">BlueprintReadOnly</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">AllowPrivateAccess</span> <span class="o">=</span> <span class="s">"true"</span><span class="p">))</span>
	<span class="k">class</span> <span class="nc">UStaticMeshComponent</span><span class="o">*</span> <span class="n">HullMesh</span><span class="p">;</span>

	<span class="cm">/** Spring arm that will offset the camera */</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">VisibleDefaultsOnly</span><span class="p">,</span> <span class="n">BlueprintReadOnly</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">AllowPrivateAccess</span> <span class="o">=</span> <span class="s">"true"</span><span class="p">))</span>
	<span class="k">class</span> <span class="nc">USpringArmComponent</span><span class="o">*</span> <span class="n">SpringArm</span><span class="p">;</span>

	<span class="cm">/** Camera component that will be our viewpoint */</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">VisibleDefaultsOnly</span><span class="p">,</span> <span class="n">BlueprintReadOnly</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">AllowPrivateAccess</span> <span class="o">=</span> <span class="s">"true"</span><span class="p">))</span>
	<span class="k">class</span> <span class="nc">UCameraComponent</span><span class="o">*</span> <span class="n">Camera</span><span class="p">;</span>
	
	<span class="c1">// Sets default values for this actor's properties</span>
	<span class="n">AShipBase</span><span class="p">(</span><span class="k">const</span> <span class="n">FObjectInitializer</span><span class="o">&amp;</span> <span class="n">ObjectInitializer</span><span class="p">);</span>

	<span class="c1">// Called when the game starts or when spawned</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">BeginPlay</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
	
	<span class="c1">// Called every frame</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Tick</span><span class="p">(</span> <span class="kt">float</span> <span class="n">DeltaSeconds</span> <span class="p">)</span> <span class="k">override</span><span class="p">;</span>

        <span class="cm">/** Returns PlaneMesh subobject **/</span>
	<span class="n">FORCEINLINE</span> <span class="k">class</span> <span class="nc">UStaticMeshComponent</span><span class="o">*</span> <span class="nf">GetPlaneMesh</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">HullMesh</span><span class="p">;</span> <span class="p">}</span>
	<span class="cm">/** Returns SpringArm subobject **/</span>
	<span class="n">FORCEINLINE</span> <span class="k">class</span> <span class="nc">USpringArmComponent</span><span class="o">*</span> <span class="nf">GetSpringArm</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">SpringArm</span><span class="p">;</span> <span class="p">}</span>
	<span class="cm">/** Returns Camera subobject **/</span>
	<span class="n">FORCEINLINE</span> <span class="k">class</span> <span class="nc">UCameraComponent</span><span class="o">*</span> <span class="nf">GetCamera</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Camera</span><span class="p">;</span> <span class="p">}</span>

<span class="k">protected</span><span class="o">:</span>

        <span class="c1">// Camera variables so we can control our camera</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">EditDefaultsOnly</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">SpringArmDistance</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">EditDefaultsOnly</span><span class="p">)</span>
		<span class="n">FVector</span> <span class="n">SpringArmSocketOffset</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">EditAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">CameraMaxPitch</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">EditAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">CameraMinPitch</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">EditAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">CameraZoomAmount</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">EditAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">CameraZoomSpeed</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">EditAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">CameraMaxZoom</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">EditAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">CameraMinZoom</span><span class="p">;</span>

	<span class="c1">// Camera CURRENT variables</span>
	<span class="kt">float</span> <span class="n">CurrentCameraZoomDistance</span><span class="p">;</span>

        <span class="c1">// Begin AActor overrides</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">SetupPlayerInputComponent</span><span class="p">(</span><span class="k">class</span> <span class="nc">UInputComponent</span> <span class="o">*</span> <span class="n">InputComponent</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
	<span class="c1">// End AActor overrides</span>

	<span class="kt">void</span> <span class="nf">CameraYawInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">Val</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">CameraPitchInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">Val</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">CameraZoom</span><span class="p">(</span><span class="kt">float</span> <span class="n">Val</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">CameraZoomIn</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">CameraZoomOut</span><span class="p">();</span>
</pre>
      </div>
      <p>
       Now with the header file completed, we will now add to our ShipBase.cpp file. First were going to modify this original constructor of the class, which should look like this right now...
      </p>
      <p>
       ShipBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="c1">// Sets default values</span>
<span class="n">AShipBase</span><span class="o">::</span><span class="n">AShipBase</span><span class="p">()</span>
<span class="p">{</span>
 	<span class="c1">// Set this pawn to call Tick() every frame.  You can turn this off to improve performance if you don't need it.</span>
	<span class="n">PrimaryActorTick</span><span class="p">.</span><span class="n">bCanEverTick</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="p">}</span>
</pre>
      </div>
      <p>
       And turn it into this...
      </p>
      <p>
       ShipBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="n">AShipBase</span><span class="o">::</span><span class="n">AShipBase</span><span class="p">(</span><span class="k">const</span> <span class="n">FObjectInitializer</span><span class="o">&amp;</span> <span class="n">ObjectInitializer</span><span class="p">)</span> <span class="o">:</span> <span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{</span>
	<span class="c1">// Initialize all base values</span>

	<span class="c1">// Set camera control defaults</span>
	<span class="n">SpringArmDistance</span> <span class="o">=</span> <span class="mf">1250.0f</span><span class="p">;</span>
	<span class="n">SpringArmSocketOffset</span> <span class="o">=</span> <span class="n">FVector</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">380.f</span><span class="p">);</span>
	<span class="n">CameraMaxPitch</span> <span class="o">=</span> <span class="mf">45.0f</span><span class="p">;</span>
	<span class="n">CameraMinPitch</span> <span class="o">=</span> <span class="o">-</span><span class="mf">45.0f</span><span class="p">;</span>
	<span class="n">CameraMaxZoom</span> <span class="o">=</span> <span class="n">SpringArmDistance</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">CameraMinZoom</span> <span class="o">=</span> <span class="mf">500.0f</span><span class="p">;</span>
	<span class="n">CameraZoomAmount</span> <span class="o">=</span> <span class="mf">250.0f</span><span class="p">;</span>
	<span class="n">CameraZoomSpeed</span> <span class="o">=</span> <span class="n">CameraZoomAmount</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>

	<span class="c1">// Create static mesh component</span>
	<span class="n">HullMesh</span> <span class="o">=</span> <span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UStaticMeshComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"HullMesh"</span><span class="p">));</span>
	<span class="n">RootComponent</span> <span class="o">=</span> <span class="n">HullMesh</span><span class="p">;</span>
	<span class="n">SpringArm</span> <span class="o">=</span> <span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">USpringArmComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"SpringArm"</span><span class="p">));</span>
	<span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">AttachToComponent</span><span class="p">(</span><span class="n">RootComponent</span><span class="p">,</span> <span class="n">FAttachmentTransformRules</span><span class="o">::</span><span class="n">KeepRelativeTransform</span><span class="p">);</span>

	<span class="c1">// Create the spring arm component</span>
	<span class="n">SpringArmDistance</span> <span class="o">=</span> <span class="mf">700.0f</span><span class="p">;</span>	<span class="c1">// Sets up default SpringArmDistance</span>
	<span class="n">SpringArmSocketOffset</span> <span class="o">=</span> <span class="n">FVector</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">60.f</span><span class="p">);</span>	<span class="c1">//Sets up default SpringArm Offset</span>

	
	<span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">TargetArmLength</span> <span class="o">=</span> <span class="n">SpringArmDistance</span><span class="p">;</span>
	<span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">SocketOffset</span> <span class="o">=</span> <span class="n">SpringArmSocketOffset</span><span class="p">;</span>
	<span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">bEnableCameraLag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">CameraLagSpeed</span> <span class="o">=</span> <span class="mf">15.f</span><span class="p">;</span>

	<span class="c1">// Create camera component</span>
	<span class="n">Camera</span> <span class="o">=</span> <span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UCameraComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Camera"</span><span class="p">));</span>
	<span class="n">Camera</span><span class="o">-&gt;</span><span class="n">AttachToComponent</span><span class="p">(</span><span class="n">SpringArm</span><span class="p">,</span> <span class="n">FAttachmentTransformRules</span><span class="o">::</span><span class="n">KeepRelativeTransform</span><span class="p">,</span> <span class="n">USpringArmComponent</span><span class="o">::</span><span class="n">SocketName</span><span class="p">);</span>
	<span class="n">Camera</span><span class="o">-&gt;</span><span class="n">bUsePawnControlRotation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// Don't rotate camera with the controller</span>

	<span class="n">HullMesh</span><span class="o">-&gt;</span><span class="n">SetCollisionObjectType</span><span class="p">(</span><span class="n">ECC_Pawn</span><span class="p">);</span>
	<span class="n">HullMesh</span><span class="o">-&gt;</span><span class="n">SetCollisionEnabled</span><span class="p">(</span><span class="n">ECollisionEnabled</span><span class="o">::</span><span class="n">QueryAndPhysics</span><span class="p">);</span>

	<span class="c1">// Set this actor to call Tick() every frame.  You can turn this off to improve performance if you don't need it.</span>
	<span class="n">PrimaryActorTick</span><span class="p">.</span><span class="n">bCanEverTick</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       Whew! That was a big change. But were not done just yet, we now should add in our input controls for our camera! Remember you have to match this code in the input controls of the engine!
      </p>
      <p>
       ShipBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="k">class</span> <span class="nc">UInputComponent</span> <span class="o">*</span><span class="n">InputComponent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">check</span><span class="p">(</span><span class="n">InputComponent</span><span class="p">);</span>
	<span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">BindAxis</span><span class="p">(</span><span class="s">"CameraYaw"</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraYawInput</span><span class="p">);</span>
	<span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">BindAxis</span><span class="p">(</span><span class="s">"CameraPitch"</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraPitchInput</span><span class="p">);</span>
	<span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="s">"MouseWheelUp"</span><span class="p">,</span> <span class="n">IE_Pressed</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraZoomIn</span><span class="p">);</span>
	<span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="s">"MouseWheelDown"</span><span class="p">,</span> <span class="n">IE_Pressed</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraZoomOut</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraYawInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">Val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">RelativeRotation</span><span class="p">.</span><span class="n">Yaw</span> <span class="o">+=</span> <span class="n">Val</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraPitchInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">Val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">float</span> <span class="n">NewPitch</span> <span class="o">=</span> <span class="p">(</span><span class="n">Val</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">)</span> <span class="o">+</span> <span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">RelativeRotation</span><span class="p">.</span><span class="n">Pitch</span><span class="p">;</span>
	<span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">RelativeRotation</span><span class="p">.</span><span class="n">Pitch</span> <span class="o">=</span> <span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewPitch</span><span class="p">,</span> <span class="n">CameraMinPitch</span><span class="p">,</span> <span class="n">CameraMaxPitch</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraZoom</span><span class="p">(</span><span class="kt">float</span> <span class="n">Val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">CurrentCameraZoomDistance</span> <span class="o">=</span> <span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">TargetArmLength</span><span class="p">;</span>
	<span class="n">SpringArmDistance</span> <span class="o">=</span> <span class="n">CurrentCameraZoomDistance</span> <span class="o">+</span> <span class="p">(</span><span class="n">CameraZoomAmount</span> <span class="o">*</span> <span class="n">Val</span><span class="p">);</span>
	<span class="kt">float</span> <span class="n">TargetArmDistance</span> <span class="o">=</span> <span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">SpringArmDistance</span><span class="p">,</span> <span class="n">CameraMinZoom</span><span class="p">,</span> <span class="n">CameraMaxZoom</span><span class="p">);</span>
	<span class="n">SpringArm</span><span class="o">-&gt;</span><span class="n">TargetArmLength</span> <span class="o">=</span> <span class="n">FMath</span><span class="o">::</span><span class="n">FInterpTo</span><span class="p">(</span><span class="n">CurrentCameraZoomDistance</span><span class="p">,</span> <span class="n">TargetArmDistance</span><span class="p">,</span> <span class="n">GetWorld</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetDeltaSeconds</span><span class="p">(),</span> <span class="n">CameraZoomSpeed</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraZoomIn</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">CameraZoom</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">CameraZoomOut</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">CameraZoom</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       Now were in business! With the initial set up of our ShipBase class, we now need to go on to getting our TurretBase class set up as well!
      </p>
      <h3>
       <span class="mw-headline" id="TurretBase_Class">
        TurretBase Class
       </span>
      </h3>
      <p>
       So similarly in the ShipBase.h, we want to get out TurretBase.h file up to snuff. So lets get our class filled out properly...
      </p>
      <p>
       TurretBase.h
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">TURRETTUTORIAL_API</span> <span class="nl">ATurretBase</span> <span class="p">:</span> <span class="k">public</span> <span class="n">APawn</span><span class="p">,</span> <span class="k">public</span> <span class="n">ITurretInterface</span>
<span class="p">{</span>
	<span class="n">GENERATED_BODY</span><span class="p">()</span>
	
<span class="k">public</span><span class="o">:</span>	
	<span class="c1">// Public Variables</span>
	<span class="n">FRotator</span> <span class="n">TurretLocalRot</span><span class="p">;</span>

	<span class="c1">// Sets default values for this actor's properties</span>
	<span class="n">ATurretBase</span><span class="p">(</span><span class="k">const</span> <span class="n">FObjectInitializer</span><span class="o">&amp;</span> <span class="n">ObjectInitializer</span><span class="p">);</span>

	<span class="cm">/** StaticMesh component that will be the visuals for the turret */</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">EditDefaultsOnly</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">AllowPrivateAccess</span> <span class="o">=</span> <span class="s">"true"</span><span class="p">))</span>
		<span class="k">class</span> <span class="nc">UStaticMeshComponent</span><span class="o">*</span> <span class="n">TurretHullMesh</span><span class="p">;</span>

        <span class="cm">/** StaticMesh component that will be the visuals for the barrels */</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">EditDefaultsOnly</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">AllowPrivateAccess</span> <span class="o">=</span> <span class="s">"true"</span><span class="p">))</span>
		<span class="k">class</span> <span class="nc">UStaticMeshComponent</span><span class="o">*</span> <span class="n">TurretBarrelMesh</span><span class="p">;</span>

	<span class="c1">// Called when the game starts or when spawned</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">BeginPlay</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
	
	<span class="c1">// Called every frame</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Tick</span><span class="p">(</span> <span class="kt">float</span> <span class="n">DeltaSeconds</span> <span class="p">)</span> <span class="k">override</span><span class="p">;</span>

	<span class="kt">void</span> <span class="nf">TurretLookAt</span><span class="p">();</span>

	<span class="c1">// Spawns Munitions</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">BlueprintSpawn</span><span class="p">,</span> <span class="n">EditDefaultsOnly</span><span class="p">,</span> <span class="n">BlueprintReadOnly</span><span class="p">)</span>
		<span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">AMunitionsBase</span><span class="o">&gt;</span> <span class="n">MunitionsBP</span><span class="p">;</span>
	<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span> <span class="n">MuzzleArray</span><span class="p">;</span>
	<span class="kt">void</span> <span class="nf">GetMuzzleSockets</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">SpawnMunitions</span><span class="p">(</span><span class="n">FName</span> <span class="n">_MuzzleSocketName</span><span class="p">);</span>

	<span class="c1">//ITurretInterface</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">PrimaryFireControl</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Chasis</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">VisibleAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">TurretYawSpeed</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Chasis</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">VisibleAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">TurretMaxYaw</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Chasis</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">VisibleAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">TurretMinYaw</span><span class="p">;</span>

	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Barrel</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">VisibleAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">TurretPitchSpeed</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Barrel</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">VisibleAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">TurretMaxPitch</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Barrel</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">VisibleAnywhere</span><span class="p">)</span>
		<span class="kt">float</span> <span class="n">TurretMinPitch</span><span class="p">;</span>

	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Control</span><span class="p">,</span> <span class="n">BlueprintReadWrite</span><span class="p">,</span> <span class="n">EditDefaultsOnly</span><span class="p">)</span>
		<span class="kt">bool</span> <span class="n">IsOccupied</span><span class="p">;</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">Control</span><span class="p">,</span> <span class="n">BlueprintReadOnly</span><span class="p">,</span> <span class="n">VisibleAnywhere</span><span class="p">)</span>
		<span class="kt">bool</span> <span class="n">IsTargeting</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
	<span class="kt">bool</span> <span class="n">IsFiring</span><span class="p">;</span>
	<span class="kt">float</span> <span class="n">CurrentChasisRot</span><span class="p">;</span>
	<span class="kt">float</span> <span class="n">CurrentBarrelRot</span><span class="p">;</span>
	<span class="kt">float</span> <span class="n">CurrentYawMin</span><span class="p">;</span>
	<span class="kt">float</span> <span class="n">CurrentYawMax</span><span class="p">;</span>
	<span class="n">FRotator</span> <span class="n">CurrentTurretRot</span><span class="p">;</span>
	<span class="n">FRotator</span> <span class="n">TurretYawRot</span><span class="p">;</span>
	<span class="n">FRotator</span> <span class="n">TurretPitchRot</span><span class="p">;</span>
	
<span class="p">};</span>
</pre>
      </div>
      <p>
       So now we want to do the same thing with the base constructor class that was generated for us as we did in the ShipBase.cpp file. We want to turn it into this...
      </p>
      <p>
       TurretBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="c1">// Sets default values</span>
<span class="n">ATurretBase</span><span class="o">::</span><span class="n">ATurretBase</span><span class="p">(</span><span class="k">const</span> <span class="n">FObjectInitializer</span><span class="o">&amp;</span> <span class="n">ObjectInitializer</span><span class="p">)</span> <span class="o">:</span> <span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{</span>

	<span class="c1">// Create the static mesh component</span>
	<span class="n">TurretHullMesh</span> <span class="o">=</span> <span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UStaticMeshComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"TurretHullMesh"</span><span class="p">));</span>
	<span class="n">TurretBarrelMesh</span> <span class="o">=</span> <span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UStaticMeshComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"TurretBarrelMesh"</span><span class="p">));</span>
	<span class="n">RootComponent</span> <span class="o">=</span> <span class="n">TurretHullMesh</span><span class="p">;</span>
	<span class="n">TurretBarrelMesh</span><span class="o">-&gt;</span><span class="n">AttachToComponent</span><span class="p">(</span><span class="n">RootComponent</span><span class="p">,</span> <span class="n">FAttachmentTransformRules</span><span class="o">::</span><span class="n">KeepRelativeTransform</span><span class="p">);</span>

	<span class="c1">// Set default variables</span>
	<span class="n">IsOccupied</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">IsFiring</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">TurretYawSpeed</span> <span class="o">=</span> <span class="mf">20.f</span><span class="p">;</span>
	<span class="n">TurretMaxYaw</span> <span class="o">=</span> <span class="mf">180.f</span><span class="p">;</span>
	<span class="n">TurretMinYaw</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.f</span><span class="p">;</span>
	<span class="n">TurretPitchSpeed</span> <span class="o">=</span> <span class="mf">20.f</span><span class="p">;</span>
	<span class="n">TurretMaxPitch</span> <span class="o">=</span> <span class="mf">45.f</span><span class="p">;</span>
	<span class="n">TurretMinPitch</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.f</span><span class="p">;</span>

	<span class="n">TurretLocalRot</span> <span class="o">=</span> <span class="n">FRotator</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">);</span>
	<span class="n">TurretYawRot</span> <span class="o">=</span> <span class="n">FRotator</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">);</span>
	<span class="n">TurretPitchRot</span> <span class="o">=</span> <span class="n">FRotator</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">);</span>

	<span class="n">CurrentYawMax</span> <span class="o">=</span> <span class="p">(</span><span class="n">TurretHullMesh</span><span class="o">-&gt;</span><span class="n">GetRelativeTransform</span><span class="p">().</span><span class="n">GetRotation</span><span class="p">().</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">TurretMaxYaw</span><span class="p">;</span>
	<span class="n">CurrentYawMin</span> <span class="o">=</span> <span class="p">(</span><span class="n">TurretHullMesh</span><span class="o">-&gt;</span><span class="n">GetRelativeTransform</span><span class="p">().</span><span class="n">GetRotation</span><span class="p">().</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">TurretMinYaw</span><span class="p">;</span>

	<span class="n">IsTargeting</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

 	<span class="c1">// Set this actor to call Tick() every frame.  You can turn this off to improve performance if you don't need it.</span>
	<span class="n">PrimaryActorTick</span><span class="p">.</span><span class="n">bCanEverTick</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="p">}</span>
</pre>
      </div>
      <p>
       Next we want to prepare our Tick event. What we are doing here is simply calling a function every frame that will handle the turrets logic to look at our camera's focal point!
      </p>
      <p>
       TurretBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="c1">// Called every frame</span>
<span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span> <span class="kt">float</span> <span class="n">DeltaTime</span> <span class="p">)</span>
<span class="p">{</span>
	<span class="n">TurretLookAt</span><span class="p">();</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span> <span class="n">DeltaTime</span> <span class="p">);</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       With that complete lets actually just get in an empty class so we can compile. We will handle the TurretLookAt logic in just a bit. While we do that, lets get a few more skeleton functions out of the way.
      </p>
      <p>
       TurretBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">TurretLookAt</span><span class="p">()</span>
<span class="p">{</span>

<span class="p">}</span>

<span class="cm">/* ITurretInterface */</span>
<span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">PrimaryFireControl</span><span class="p">()</span>
<span class="p">{</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">GetMuzzleSockets</span><span class="p">()</span> 
<span class="p">{</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">SpawnMunitions</span><span class="p">(</span><span class="n">FName</span> <span class="n">_MuzzleSocketName</span><span class="p">)</span> 
<span class="p">{</span>

<span class="p">}</span>
</pre>
      </div>
      <p>
       With that, compile! We should have the base classes started! The next step is to get them extended into Blueprints to begin getting some results.
      </p>
      <h2>
       <span class="mw-headline" id="Extending_The_Base_Classes">
        Extending The Base Classes
       </span>
      </h2>
      <p>
       So now that were done getting the basics of the classes in, let's quickly extend those two classes into blueprints so we can set up the turret and the ship!
      </p>
      <p>
       Let's do the ship first. It should be really straight forward and simple. Right click in the content browser and click Blueprint Class.
      </p>
      <p>
       Now when it asks to pick a parent class, you want to go to the very bottom of the window, where it says All Classes, click that and then type in ShipBase (Or whatever you named it)
      </p>
      <p>
       <img alt="ExtendingShip.png" class="" height="526" src="../assets/c-camera-controlled-turrets/4.png" width="544"/>
      </p>
      <p>
       Click Create, then name the blueprint what ever you want. I named it BP_Ship. Do the same thing for the TurretBase.
      </p>
      <p>
       Once the blueprints are created, there is not much else to do for the BP_Ship. But there is something you need to take care of in the BP_Turret. Open it up, and go to the Viewport tab on the turret, then adjust the barrel mesh so it sits correctly on your turrets Chasis. In the end you should have something like the following two images.
      </p>
      <p>
       <img alt="BP Ship.png" class="" height="838" src="../assets/c-camera-controlled-turrets/5.png" width="1437"/>
       <img alt="BP Turret.png" class="" height="816" src="../assets/c-camera-controlled-turrets/6.png" width="1441"/>
      </p>
      <h2>
       <span class="mw-headline" id="Adding_Turret_Functionality">
        Adding Turret Functionality
       </span>
      </h2>
      <p>
       Now with all the previous work set up and running, now we can focus on adding functionality to our turrets!
      </p>
      <h3>
       <span class="mw-headline" id="Turret_Spawn_Logic">
        Turret Spawn Logic
       </span>
      </h3>
      <p>
       So in this section we are going to get the code in to spawn the turrets onto our ship! This can be done with a simple addition to our ShipBase class file. What we are going to do is create a set of functions in our Ship class that will handle finding the turret sockets, spawning the turrets to those turret sockets, and then have a function to delete the spawned turrets properly so when the ship dies in your game, it will do the proper deletion.
      </p>
      <p>
       So go back to your IDE and add the code below.
      </p>
      <p>
       ShipBase.h
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span>        <span class="c1">// Spawn Turrets</span>
	<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="n">BlueprintSpawn</span><span class="p">,</span> <span class="n">EditDefaultsOnly</span><span class="p">,</span> <span class="n">BlueprintReadOnly</span><span class="p">)</span>
		<span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">ATurretBase</span><span class="o">&gt;</span> <span class="n">TurretBP</span><span class="p">;</span>
	<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span> <span class="n">TurretArray</span><span class="p">;</span>
	<span class="n">TArray</span><span class="o">&lt;</span><span class="n">ATurretBase</span><span class="o">*&gt;</span> <span class="n">SpawnedTurretArray</span><span class="p">;</span>

	<span class="kt">void</span> <span class="nf">GetTurretSockets</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">SpawnTurret</span><span class="p">(</span><span class="n">FName</span> <span class="n">_TurretSocketName</span><span class="p">);</span>
        <span class="kt">void</span> <span class="nf">DestroyTurrets</span><span class="p">();</span>
</pre>
      </div>
      <p>
       Now got to ShipBase.cpp and lets fill out those three functions!
      </p>
      <p>
       ShipBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">GetTurretSockets</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// We store all the socket names into our own Turret Array</span>
	<span class="n">TurretArray</span> <span class="o">=</span> <span class="n">HullMesh</span><span class="o">-&gt;</span><span class="n">GetAllSocketNames</span><span class="p">();</span>
        <span class="c1">// Then we iterate through that array and call our SpawnTurret() function and pass it our array's index</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">TurretArray</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">SpawnTurret</span><span class="p">(</span><span class="n">TurretArray</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/** Spawns the turrets onto the sockets of the ship */</span>
<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">SpawnTurret</span><span class="p">(</span><span class="n">FName</span> <span class="n">_TurretSocketName</span><span class="p">)</span>
<span class="p">{</span>
        <span class="c1">// First we want to make sure these values are all zeroed out</span>
	<span class="n">FVector</span> <span class="n">SocketLocation</span><span class="p">;</span>
	<span class="n">FTransform</span> <span class="n">SocketTransform</span><span class="p">;</span>
	<span class="n">SocketLocation</span> <span class="o">=</span> <span class="n">FVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">SocketLocation</span><span class="p">.</span><span class="n">Rotation</span><span class="p">()</span> <span class="o">=</span> <span class="n">FRotator</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

        <span class="c1">// Make sure the world exists first</span>
	<span class="n">UWorld</span><span class="o">*</span> <span class="k">const</span> <span class="n">World</span> <span class="o">=</span> <span class="n">GetWorld</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">World</span> <span class="o">&amp;&amp;</span> <span class="n">TurretBP</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
	<span class="p">{</span>
                <span class="c1">// Set the spawn parameters</span>
		<span class="n">FActorSpawnParameters</span> <span class="n">SpawnParams</span><span class="p">;</span>
		<span class="n">SpawnParams</span><span class="p">.</span><span class="n">Owner</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
		
                <span class="c1">// This is where we instantiate our new Turret! RailGun_T can be whatever you want to name it </span>
		<span class="n">ATurretBase</span><span class="o">*</span> <span class="n">RailGun_T</span> <span class="o">=</span> <span class="n">GetWorld</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SpawnActor</span><span class="o">&lt;</span><span class="n">ATurretBase</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TurretBP</span><span class="p">,</span> <span class="n">SocketLocation</span><span class="p">,</span> <span class="n">SocketLocation</span><span class="p">.</span><span class="n">Rotation</span><span class="p">());</span>
                <span class="c1">// Assign our newly spawned turret its rotation</span>
		<span class="n">RailGun_T</span><span class="o">-&gt;</span><span class="n">TurretLocalRot</span> <span class="o">=</span> <span class="n">SocketLocation</span><span class="p">.</span><span class="n">Rotation</span><span class="p">();</span>

                <span class="c1">// Now we add that newly spawned turret to our array of pointers so we can reference it later</span>
		<span class="n">SpawnedTurretArray</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">RailGun_T</span><span class="p">);</span>

                <span class="c1">// Now we make sure our turret isn't null, and then attach it to our socket's location.</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">RailGun_T</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> 
		<span class="p">{</span>
			<span class="n">RailGun_T</span><span class="o">-&gt;</span><span class="n">AttachToComponent</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">RootComponent</span><span class="p">,</span> <span class="n">FAttachmentTransformRules</span><span class="o">::</span><span class="n">KeepRelativeTransform</span><span class="p">,</span> <span class="n">_TurretSocketName</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">DestroyTurrets</span><span class="p">()</span>
<span class="p">{</span>
        <span class="c1">// Iterate over the turrets in the array we have them stored</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SpawnedTurretArray</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">SpawnedTurretArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">DetachFromControllerPendingDestroy</span><span class="p">();</span>
		<span class="n">SpawnedTurretArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Destroy</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       Now you just need to add our spawn function to the BeginPlay in ShipBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="c1">// Called when the game starts or when spawned</span>
<span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span>

	<span class="n">GetTurretSockets</span><span class="p">();</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       Let us recap on what we did. First we went into the header file and created a few variables and three functions. The variables are important for a few reasons.
      </p>
      <ul>
       <li>
        TSubclassOf&lt;ATurretBase&gt; TurretBP;
        <ul>
         <li>
          This creates a pointer that we assign in our BP_Ship for any turret we want! We can create multiple of these pointers for when we have multiple different types of turrets.
         </li>
        </ul>
       </li>
       <li>
        TArray&lt;FName&gt; TurretArray;
        <ul>
         <li>
          We did this to hold onto the sockets we find.
         </li>
        </ul>
       </li>
       <li>
        TArray&lt;ATurretBase*&gt; SpawnedTurretArray;
        <ul>
         <li>
          We created this to hold onto the spawned turrets so we can easily reference them later.
         </li>
        </ul>
       </li>
      </ul>
      <p>
       Now for the functions, we have three.
      </p>
      <ol>
       <li>
        void GetTurretSockets();
        <ul>
         <li>
          To get the turret sockets on the ship.
         </li>
        </ul>
       </li>
       <li>
        void SpawnTurret(FName _TurretSocketName);
        <ul>
         <li>
          To spawn a single turret, by passing it the socket we want it spawned to.
         </li>
        </ul>
       </li>
       <li>
        void DestroyTurrets();
        <ul>
         <li>
          To delete all the turrets we spawned for proper deletion for when the ship is deleted (during game-play)
         </li>
        </ul>
       </li>
      </ol>
      <p>
       Now compile your code! Now if you go into the engine and double click your ship blueprint, in the details pane you should see a category called Blueprint Spawn. Inside that category is a picker, you want to click it and add in your Turret Blueprint.
      </p>
      <p>
       <img alt="BP ShipDetails.png" class="" height="58" src="../assets/c-camera-controlled-turrets/7.png" width="471"/>
      </p>
      <p>
       Now set the Default Pawn Class to your ship blueprint. Click Play and you should have a ship that is spawning turrets!
      </p>
      <p>
       <img alt="BP ShipSpawning.png" class="" height="539" src="../assets/c-camera-controlled-turrets/8.png" width="636"/>
      </p>
      <h3>
       <span class="mw-headline" id="Turret_Control">
        Turret Control
       </span>
      </h3>
      <p>
       Now for the more complicated step in the logic department. Getting our turrets to look at our camera's focal point. This was the entire reason why your in this tutorial now aren't you?
      </p>
      <p>
       Now before we go into the code I want to take a moment to explain what were going to try and do.
      </p>
      <p>
       So what we want is for the turrets to look at wherever our cameras focal point is. So when we look right, the turrets should track our movement and attempt to point to where we are looking. In order to do this, they need to get our forward vector to know where exactly they are going to point. In order to figure out how much they need to rotate to get to our forward vector from the camera, they will need to take their forward vectors and normalize it against the cameras. Then all we do is take that normalized vector and apply it to our local rotation and voila! Our Turrets should now be looking at our camera's focal point!
      </p>
      <p>
       It sounds pretty simple right? Well now it is! I'll be honest it took me awhile to figure this out on my own and get it working just right. So you remember that TurretLookAt() function we created? Well now it's time to fill that sucker out.
      </p>
      <p>
       In the TurretBase.cpp file, go to where you have the skeleton of the function.
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">TurretLookAt</span><span class="p">()</span>
<span class="p">{</span>
	<span class="c1">// We want a pointer to hold our player controller.</span>
	<span class="n">APlayerController</span><span class="o">*</span> <span class="n">PC</span> <span class="o">=</span> <span class="n">Cast</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">APawn</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetAttachParentActor</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">GetController</span><span class="p">());</span>
	<span class="c1">// Then we make sure our player controller exists.</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">PC</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">// Set the Focal Point Distance</span>
		<span class="kt">float</span> <span class="n">FocalDistance</span> <span class="o">=</span> <span class="mf">10000.0f</span><span class="p">;</span>
		<span class="c1">// Get Camera Vector &amp; Rotator</span>
		<span class="n">FVector</span> <span class="n">CameraLocation</span> <span class="o">=</span> <span class="n">PC</span><span class="o">-&gt;</span><span class="n">PlayerCameraManager</span><span class="o">-&gt;</span><span class="n">GetCameraLocation</span><span class="p">();</span>
		<span class="n">FRotator</span> <span class="n">CameraRotation</span> <span class="o">=</span> <span class="n">PC</span><span class="o">-&gt;</span><span class="n">PlayerCameraManager</span><span class="o">-&gt;</span><span class="n">GetCameraRotation</span><span class="p">();</span>
		<span class="c1">// Get Turrets Vector &amp; Rotator</span>
		<span class="n">FVector</span> <span class="n">TurretLocation</span> <span class="o">=</span> <span class="n">GetActorLocation</span><span class="p">();</span>
		<span class="n">FRotator</span> <span class="n">TurretRotation</span> <span class="o">=</span> <span class="n">GetActorRotation</span><span class="p">();</span>

		<span class="c1">// Handle Turret Rotation</span>
		<span class="n">FVector</span> <span class="n">FocalPoint</span> <span class="o">=</span> <span class="n">CameraLocation</span> <span class="o">+</span> <span class="p">(</span><span class="n">CameraRotation</span><span class="p">.</span><span class="n">Vector</span><span class="p">()</span> <span class="o">*</span> <span class="n">FocalDistance</span><span class="p">);</span>
		<span class="n">FVector</span> <span class="n">TurretToFocal</span> <span class="o">=</span> <span class="n">FocalPoint</span> <span class="o">-</span> <span class="n">TurretLocation</span><span class="p">;</span>
		<span class="n">FVector</span> <span class="n">TurretToFocalLocal</span> <span class="o">=</span> <span class="n">TurretRotation</span><span class="p">.</span><span class="n">UnrotateVector</span><span class="p">(</span><span class="n">TurretToFocal</span><span class="p">);</span>
		<span class="n">FRotator</span> <span class="n">TurretFocalLookDirection</span> <span class="o">=</span> <span class="n">TurretToFocalLocal</span><span class="p">.</span><span class="n">Rotation</span><span class="p">();</span>
		<span class="n">FRotator</span> <span class="n">TurretYaw</span> <span class="o">=</span> <span class="n">FRotator</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TurretFocalLookDirection</span><span class="p">.</span><span class="n">Yaw</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">CurrentTurretRot</span> <span class="o">=</span> <span class="n">GetActorRotation</span><span class="p">();</span>

		<span class="c1">// We check to see if the turret is within it's movement range, if it is, we add the rotation and do one last addition check.</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">FMath</span><span class="o">::</span><span class="n">IsWithin</span><span class="p">(</span><span class="n">CurrentTurretRot</span><span class="p">.</span><span class="n">Yaw</span><span class="p">,</span> <span class="n">TurretMinYaw</span><span class="p">,</span> <span class="n">TurretMaxYaw</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="n">TurretHullMesh</span><span class="o">-&gt;</span><span class="n">AddRelativeRotation</span><span class="p">(</span><span class="n">TurretYaw</span><span class="p">);</span>
			<span class="c1">// Now we check to see if it's pretty close to our target, when it is we toggle a boolean to be used later!</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">TurretYaw</span><span class="p">.</span><span class="n">Yaw</span> <span class="o">&gt;</span> <span class="mf">0.f</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">IsTargeting</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">IsTargeting</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// Now it's time to do the same for the turret's barrels pitch!</span>
		<span class="n">FRotator</span> <span class="n">TurretBarrelPitch</span> <span class="o">=</span> <span class="n">FRotator</span><span class="p">(</span><span class="n">TurretFocalLookDirection</span><span class="p">.</span><span class="n">Pitch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">TurretBarrelPitch</span><span class="p">.</span><span class="n">Pitch</span> <span class="o">=</span> <span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">TurretBarrelPitch</span><span class="p">.</span><span class="n">Pitch</span><span class="p">,</span> <span class="n">TurretMinPitch</span><span class="p">,</span> <span class="n">TurretMaxPitch</span><span class="p">);</span>
		<span class="n">TurretBarrelMesh</span><span class="o">-&gt;</span><span class="n">SetRelativeRotation</span><span class="p">(</span><span class="n">TurretBarrelPitch</span><span class="p">);</span>

		<span class="c1">// Do the targeting check with the barrels as well!</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">TurretBarrelPitch</span><span class="p">.</span><span class="n">Pitch</span> <span class="o">==</span> <span class="n">TurretFocalLookDirection</span><span class="p">.</span><span class="n">Pitch</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">IsTargeting</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">IsTargeting</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       Now with that filled out, we want to go to our Tick() function and add our function call to it!
      </p>
      <p>
       TurretBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="c1">// Called every frame</span>
<span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span> <span class="kt">float</span> <span class="n">DeltaTime</span> <span class="p">)</span>
<span class="p">{</span>
	<span class="n">TurretLookAt</span><span class="p">();</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span> <span class="n">DeltaTime</span> <span class="p">);</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       Compile and run the game! Now your turrets should rotate and the barrels should pitch! And that is how you get your turrets to follow your cameras focal point!
      </p>
      <p>
       <img alt="BP TurretControl.png" class="" height="595" src="../assets/c-camera-controlled-turrets/9.png" width="1436"/>
      </p>
      <h3>
       <span class="mw-headline" id="Turret_Firing">
        Turret Firing
       </span>
      </h3>
      <p>
       Now, how about we get those turrets to fire? Everybody likes a good BOOM to their code! Now this section will be a little less informative. It's a challenge out to you to actually get the some of the set up work done! You've done it before, now you should have the tools to get the Munitions ready!
      </p>
      <p>
       For how I got my projectiles set up, was that I followed the same steps in creating a MunitionsBase Class, and then I got it set up to hold a spherical mesh. Once that was done I made sure I added it to a collision channel for the projectiles.
      </p>
      <p>
       Once you have the projectile class created, extend it into a blueprint!
      </p>
      <p>
       Now that we have a munitions object to use, lets go back to our TurretBase.cpp. You remember earlier making a few more skeletons functions that we haven't filled out yet. Those functions were PrimaryFireControl(), GetMuzzleSockets(), and then SpawnMunitions().
      </p>
      <p>
       It follows the similar path as to spawning the turrets. We want to find the muzzle sockets on the barrel mesh, add it to an array, then spawn the projectiles at the muzzle locations and add an impulse to the projectile.
      </p>
      <p>
       TurretBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cm">/* ITurretInterface */</span>
<span class="c1">// This acts as a gate for firing any projectiles. So if the turrets cannot see your cameras focal point they wont fire!</span>
<span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">PrimaryFireControl</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IsTargeting</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">GetMuzzleSockets</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Same steps as to getting the sockets for the turrets!</span>
<span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">GetMuzzleSockets</span><span class="p">()</span> 
<span class="p">{</span>
	<span class="n">MuzzleArray</span> <span class="o">=</span> <span class="n">TurretBarrelMesh</span><span class="o">-&gt;</span><span class="n">GetAllSocketNames</span><span class="p">();</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MuzzleArray</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">SpawnMunitions</span><span class="p">(</span><span class="n">MuzzleArray</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Almost the same as spawning the turrets, but this time we check to make sure the projectile blueprint exists</span>
<span class="kt">void</span> <span class="n">ATurretBase</span><span class="o">::</span><span class="n">SpawnMunitions</span><span class="p">(</span><span class="n">FName</span> <span class="n">_MuzzleSocketName</span><span class="p">)</span> 
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">MunitionsBP</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">// Get the location and the rotation for the new projectile</span>
		<span class="n">FVector</span> <span class="n">SpawnLocation</span> <span class="o">=</span> <span class="n">TurretBarrelMesh</span><span class="o">-&gt;</span><span class="n">GetSocketLocation</span><span class="p">(</span><span class="n">_MuzzleSocketName</span><span class="p">);</span>
		<span class="n">FRotator</span> <span class="n">SpawnRotation</span> <span class="o">=</span> <span class="n">TurretBarrelMesh</span><span class="o">-&gt;</span><span class="n">GetSocketRotation</span><span class="p">(</span><span class="n">_MuzzleSocketName</span><span class="p">);</span>

		<span class="c1">// Making sure the world exists, if it does we spawn it!</span>
		<span class="n">UWorld</span><span class="o">*</span> <span class="k">const</span> <span class="n">World</span> <span class="o">=</span> <span class="n">GetWorld</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">World</span> <span class="o">&amp;&amp;</span> <span class="n">MunitionsBP</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">AMunitionsBase</span><span class="o">*</span> <span class="n">Projectile</span> <span class="o">=</span> <span class="n">World</span><span class="o">-&gt;</span><span class="n">SpawnActor</span><span class="o">&lt;</span><span class="n">AMunitionsBase</span><span class="o">&gt;</span><span class="p">(</span><span class="n">MunitionsBP</span><span class="p">,</span> <span class="n">SpawnLocation</span><span class="p">,</span> <span class="n">SpawnRotation</span><span class="p">);</span>

			<span class="c1">// We give the projectiles an owner! This can be used later for hit detection and the like!</span>
			<span class="n">Projectile</span><span class="o">-&gt;</span><span class="n">OwningPlayer</span> <span class="o">=</span> <span class="n">GetController</span><span class="p">();</span>
			<span class="n">Projectile</span><span class="o">-&gt;</span><span class="n">OwningActor</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">GetAttachParentActor</span><span class="p">();</span>

			<span class="c1">// This is completely option. I made a muzzle flash for fun. You can remove the below If statement if you want.</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">MuzzleFX</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">UParticleSystemComponent</span><span class="o">*</span> <span class="n">MuzzleFlash</span> <span class="o">=</span> <span class="n">UGameplayStatics</span><span class="o">::</span><span class="n">SpawnEmitterAtLocation</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">MuzzleFX</span><span class="p">,</span> <span class="n">SpawnLocation</span><span class="p">,</span> <span class="n">SpawnRotation</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       Now in order to make sure you can fire your turrets, we need to make sure we have a player input set up in the editor to control that. But one more step needs to be taken to tell the turrets that the player is firing! We can't just simply add the controls to the turrets themselves, we are going to take advantage of that Interface function, PrimaryFireControl()!
      </p>
      <p>
       Now go to your ShipBase.cpp and add a input component.
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="s">"PrimaryFire"</span><span class="p">,</span> <span class="n">IE_Pressed</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">AShipBase</span><span class="o">::</span><span class="n">ShipPrimaryFire</span><span class="p">);</span>
</pre>
      </div>
      <p>
       Now we create the function! We are still in ShipBase.cpp. What were going to do here is loop through the SpawnedTurretArray and with the interface, tell them to execute the function PrimaryFireControl(). One purpose of Interfaces is to give us a way to call functions in another class or object when we don't want to hold onto the instantiated class in caller.
      </p>
      <p>
       ShipBase.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="kt">void</span> <span class="n">AShipBase</span><span class="o">::</span><span class="n">ShipPrimaryFire</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SpawnedTurretArray</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ITurretInterface</span><span class="o">*</span> <span class="n">TheInterface</span> <span class="o">=</span> <span class="n">Cast</span><span class="o">&lt;</span><span class="n">ITurretInterface</span><span class="o">&gt;</span><span class="p">(</span><span class="n">SpawnedTurretArray</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">TheInterface</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">TheInterface</span><span class="o">-&gt;</span><span class="n">PrimaryFireControl</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       <img alt="TurretFire.png" class="" height="491" src="../assets/c-camera-controlled-turrets/10.png" width="1397"/>
      </p>
      <p>
       Now before we continue, there is one last thing we need to do! You need to add a blank C++ class through the editor, you should name these files TurretInterface. Fill these files out like so.
      </p>
      <p>
       TurretInterface.cpp
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cp">#include</span> <span class="cpf">"TurretTutorial.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"TurretInterface.h"</span><span class="cp"></span>

<span class="n">UTurretInterface</span><span class="o">::</span><span class="n">UTurretInterface</span><span class="p">(</span><span class="k">const</span> <span class="n">FObjectInitializer</span><span class="o">&amp;</span> <span class="n">ObjectInitializer</span><span class="p">)</span>
	<span class="o">:</span> <span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{</span>

<span class="p">}</span>

<span class="c1">// This is required for compiling, would also let you know if somehow you called</span>
<span class="c1">// the base event/function rather the override version</span>
<span class="kt">void</span> <span class="n">ITurretInterface</span><span class="o">::</span><span class="n">PrimaryFireControl</span><span class="p">()</span>
<span class="p">{</span>

<span class="p">}</span>
</pre>
      </div>
      <p>
       TurretInterface.h
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">"TurretInterface.generated.h"</span><span class="cp"></span>

<span class="n">UINTERFACE</span><span class="p">(</span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UTurretInterface</span> <span class="o">:</span> <span class="k">public</span> <span class="n">UInterface</span>
<span class="p">{</span>
	<span class="n">GENERATED_UINTERFACE_BODY</span><span class="p">()</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">ITurretInterface</span>
<span class="p">{</span>
	<span class="n">GENERATED_IINTERFACE_BODY</span><span class="p">()</span>

<span class="k">public</span><span class="o">:</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">PrimaryFireControl</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      </div>
      <p>
       Now, with this you should be able to compile your project. These two files are primarily to set up the class, to be accessible globally but more importantly, allow the project to compile! Now let me spend just a moment to explain why the interface is useful and how it pertains to our application here. Interfaces in C++ allow you to set up game wide event triggers directly in C++ or the level blueprint. Now I wont spend the time explaining on how to open the C++ Interfaces to blueprints in this tutorial, but I may cover it in my second tutorial when I extend this out to support C++ Networking.
      </p>
      <p>
       You can set up Interfaces like the one we just did for many things, for example, creating a special event such as a capital ship exploding and then having a multitude of different actors respond to it.
      </p>
      <h2>
       <span class="mw-headline" id="Conclusion">
        Conclusion
       </span>
      </h2>
      <p>
       There you have it! You now have a ship that can spawn turrets that will look to where your camera is pointing and also fire! Your just a couple steps away from creating a ship to ship combat game! This is just one out of a few ways of accomplishing this, and I do not claim this the most efficient but it is the solution I came up with. I'm particularly proud of it and find it a big achievement.
      </p>
      <p>
       I do hope you found this tutorial helpful! If you have any questions or suggestions, feel free to PM me on the Unreal Engine Forums! It is after all my first tutorial and would love some feedback!
      </p>
      <p>
       IntVoid
      </p>
      <p>
       (
     )
      </p>
     </div>
    </div>
    <div class="visualClear">
    </div>
   </div>
  </div>
 </body>
</html>